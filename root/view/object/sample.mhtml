<%args>
$object
$type
</%args>

<&| /view/object/object_top.mhtml, object => $object, 
  field_labels => [qw(name description genotype protocol molecule_type
                   treatment_type fractionation_type tissue
                   processing_requirement)]&>
  <div>
    <a href="<% $c->uri_for('/custom/create_seq_run', { 'sample.id' => $object->sample_id() }) %>">
      Create a non-multiplexed sequencing run for this sample
    </a>
  </div>
  <div>
    <a href="<% $c->uri_for('/new/object/coded_sample', { 'sample.id' => $object->sample_id() }) %>">
      Barcode this sample
    </a>
  </div>
</&>

<div>
  <& /view/list.mhtml, type => 'pipeproject', rs => $pipeprojects_rs,
    list_title => "The project$pipeproject_plu containing this sample" &>
</div>
<div>
  <& /view/list.mhtml, type => 'organism', rs => $organisms_rs,
    list_title => "The organism$organism_plu for this sample" &>
</div>
<div>
  <& /view/list.mhtml, type => 'ecotype', rs => $ecotypes_rs,
    list_title => "The ecotype$ecotype_plu for this sample" &>
</div>
<div style="clear: both">
  <& /view/list.mhtml, type => 'sequencingrun', rs => $seqruns_rs,
    list_title => "The sequencing run$seqruns_plu for this sample" &>
</div>
<div>
  <& /view/list.mhtml, type => 'coded_sample', rs => $coded_samples_rs,
    list_title => "The bar-coded sample$coded_samples_plu created from this sample" &>
</div>
<div>
  <& /view/list.mhtml, type => 'pipedata', rs => $pipedatas_rs,
    list_title => "The file$pipedata_plu for this sample" &>
</div>
  
<%init>
my $organisms_rs = 
  $object->sample_ecotypes()->search_related('ecotype')->search_related('organism',
                                                                        {}, { distinct => 1} );
my $organisms_count = $organisms_rs->count();
my $organism_plu = ($organisms_count != 1) ? 's' : '';
my $ecotypes_rs = 
  $object->sample_ecotypes()->search_related('ecotype');
my $ecotypes_count = $ecotypes_rs->count();
my $ecotype_plu = ($ecotypes_count != 1) ? 's' : '';
my $seqruns_rs = $object->coded_samples()->search_related('sequencing_sample')->search_related('sequencingruns');
my $seqruns_count = $seqruns_rs->count();
my $seqruns_plu = ($seqruns_count != 1) ? 's' : '';
# show only those coded_samples that have a code
my $coded_samples_rs = $object->coded_samples()->search({ barcode => { '!=' => undef }});
my $coded_samples_count = $coded_samples_rs->count();
my $coded_samples_plu = ($coded_samples_count != 1) ? 's' : '';
my $pipedatas_rs = $object->pipedatas();
my $pipedatas_count = $pipedatas_rs->count();
my $pipedata_plu = ($pipedatas_count != 1) ? 's' : '';
my $pipeprojects_rs = $object->pipeprojects();
my $pipeprojects_count = $pipeprojects_rs->count();
my $pipeproject_plu = ($pipeprojects_count != 1) ? 's' : '';
</%init>
